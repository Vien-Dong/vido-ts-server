<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="page-title">ƒêang t·∫£i...</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Georgia", serif;
        line-height: 1.8;
        color: #333;
        background: #f8f9fa;
        padding: 20px;
      }

      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-size: 1.2rem;
        color: #667eea;
      }

      .error {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        flex-direction: column;
        color: #dc3545;
        text-align: center;
      }

      .error h2 {
        margin-bottom: 10px;
      }

      .blog-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        overflow: hidden;
        display: none;
      }

      .blog-container.loaded {
        display: block;
      }

      .blog-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 60px 40px;
        text-align: center;
        position: relative;
      }

      .blog-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.2);
      }

      .blog-header * {
        position: relative;
        z-index: 1;
      }

      .blog-title {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 20px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .blog-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
        margin-bottom: 30px;
        font-style: italic;
      }

      .blog-meta {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
        font-size: 0.9rem;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .blog-content {
        padding: 50px 40px;
      }

      .blog-excerpt {
        font-size: 1.1rem;
        color: #555;
        font-style: italic;
        margin-bottom: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        border-radius: 4px;
      }

      .blog-tags {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-bottom: 30px;
      }

      .tag {
        background: #667eea;
        color: white;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
      }

      .blog-main-content {
        font-size: 1.1rem;
        line-height: 1.8;
        color: #333;
      }

      .blog-main-content p {
        margin-bottom: 20px;
      }

      .blog-main-content h2 {
        font-size: 1.8rem;
        color: #333;
        margin: 40px 0 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
      }

      .blog-main-content h3 {
        font-size: 1.4rem;
        color: #444;
        margin: 30px 0 15px 0;
        font-weight: 600;
      }

      .blog-main-content ul,
      .blog-main-content ol {
        margin: 20px 0;
        padding-left: 30px;
      }

      .blog-main-content li {
        margin-bottom: 10px;
      }

      .blog-main-content blockquote {
        font-style: italic;
        font-size: 1.1rem;
        color: #555;
        padding: 20px;
        border-left: 4px solid #667eea;
        margin: 25px 0;
        background: #f8f9fa;
      }

      .author-info {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-top: 40px;
        padding: 25px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      .author-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
      }

      .author-details h4 {
        margin-bottom: 5px;
        color: #333;
      }

      .author-details p {
        color: #666;
        font-size: 0.9rem;
      }

      .blog-dates {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        font-size: 0.9rem;
        color: #666;
      }

      @media (max-width: 768px) {
        .back-button {
          top: 15px;
          left: 15px;
          padding: 10px 16px;
          font-size: 0.8rem;
        }

        .blog-header {
          padding: 40px 20px;
        }

        .blog-title {
          font-size: 2rem;
        }

        .blog-content {
          padding: 30px 20px;
        }

        .blog-meta {
          flex-direction: column;
          gap: 15px;
        }

        .author-info {
          flex-direction: column;
          text-align: center;
        }

        .blog-dates {
          flex-direction: column;
          gap: 10px;
        }
      }

      html {
        scroll-behavior: smooth;
      }

      .progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 3px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        z-index: 1000;
        transition: width 0.3s ease;
      }

      .back-button {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(255, 255, 255, 0.95);
        color: #333;
        border: none;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 500;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        z-index: 1001;
        backdrop-filter: blur(10px);
        text-decoration: none;
      }

      .back-button:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      .back-button:active {
        transform: translateY(0);
      }

      .back-button-icon {
        font-size: 1.1rem;
        transition: transform 0.3s ease;
      }

      .back-button:hover .back-button-icon {
        transform: translateX(-2px);
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="progress-bar" id="progressBar"></div>

    <button class="back-button" id="back-button" onclick="goBack()">
      <span class="back-button-icon">‚Üê</span>
      <span>Quay l·∫°i danh s√°ch b√†i vi·∫øt</span>
    </button>

    <!-- Loading State -->
    <div id="loading" class="loading">
      <div>
        <div class="spinner"></div>
        <p>ƒêang t·∫£i b√†i vi·∫øt...</p>
      </div>
    </div>

    <!-- Error State -->
    <div id="error" class="error" style="display: none">
      <h2>L·ªói khi t·∫£i b√†i vi·∫øt</h2>
      <p id="error-message">C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau.</p>
      <button
        onclick="window.location.reload()"
        style="
          margin-top: 20px;
          padding: 10px 20px;
          background: #667eea;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
        "
      >
        Th·ª≠ l·∫°i
      </button>
    </div>

    <!-- Blog Content -->
    <article class="blog-container" id="blog-container">
      <header class="blog-header">
        <h1 class="blog-title" id="blog-title">Ti√™u ƒë·ªÅ b√†i vi·∫øt</h1>
        <p class="blog-subtitle" id="blog-subtitle">
          Tr√≠ch ƒëo·∫°n b√†i vi·∫øt s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y
        </p>
        <div class="blog-meta">
          <div class="meta-item">
            <span>üìÖ</span>
            <span id="blog-date">Ng√†y</span>
          </div>
          <div class="meta-item">
            <span>üë§</span>
            <span id="blog-author">T√°c gi·∫£</span>
          </div>
          <div class="meta-item">
            <span>‚è±Ô∏è</span>
            <span id="reading-time">ƒêang t√≠nh...</span>
          </div>
          <div class="meta-item">
            <span>üè∑Ô∏è</span>
            <span id="blog-category">Danh m·ª•c</span>
          </div>
        </div>
      </header>

      <main class="blog-content">
        <div class="blog-excerpt" id="blog-excerpt-content">
          Tr√≠ch ƒëo·∫°n b√†i vi·∫øt s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y
        </div>

        <div class="blog-tags" id="blog-tags">
          <!-- Tags will be populated here -->
        </div>

        <div class="blog-main-content" id="blog-main-content">
          <!-- Main content will be populated here -->
        </div>

        <div class="author-info">
          <div class="author-avatar" id="author-avatar">A</div>
          <div class="author-details">
            <h4 id="author-name">T√™n t√°c gi·∫£</h4>
            <p>T√°c gi·∫£ v√† ng∆∞·ªùi t·∫°o n·ªôi dung</p>
          </div>
        </div>

        <div class="blog-dates">
          <div>
            <strong>ƒêƒÉng l√∫c:</strong> <span id="created-date">Ng√†y</span>
          </div>
          <div id="updated-date-container" style="display: none">
            <strong>C·∫≠p nh·∫≠t l√∫c:</strong> <span id="updated-date">Ng√†y</span>
          </div>
        </div>
      </main>
    </article>

    <script>
      // Configuration - Update these URLs to match your API endpoints
      const API_BASE_URL = "/api/medical"; // Change this to your API base URL
      const BLOG_ENDPOINT = "/blog";
      const CATEGORY_ENDPOINT = "/category";

      // Get blog ID from URL parameters
      function getBlogIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id");
      }

      // Format date for display
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("en-US", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Get author initials for avatar
      function getAuthorInitials(author) {
        return author
          ?.split(" ")
          .map((name) => name.charAt(0))
          .join("")
          .toUpperCase();
      }

      // Estimate reading time
      function estimateReadingTime(content) {
        const wordsPerMinute = 200;
        const words = content?.split(/\s+/).length;
        const minutes = Math.ceil(words / wordsPerMinute);
        return `${minutes} min read`;
      }

      // Convert plain text content to HTML with basic formatting
      function formatContent(content) {
        // Split content into paragraphs
        const paragraphs = content?.split("\n\n");

        return paragraphs
          .map((paragraph) => {
            if (paragraph.trim()) {
              // Check if it's a heading (starts with #)
              if (paragraph.startsWith("# ")) {
                return `<h2>${paragraph.substring(2)}</h2>`;
              } else if (paragraph.startsWith("## ")) {
                return `<h3>${paragraph.substring(3)}</h3>`;
              } else {
                return `<p>${paragraph}</p>`;
              }
            }
            return "";
          })
          .join("");
      }

      // Show error message
      function showError(message) {
        document.getElementById("loading").style.display = "none";
        document.getElementById("error").style.display = "flex";
        document.getElementById("error-message").textContent = message;
      }

      // Fetch blog data
      async function fetchBlogData(blogId) {
        try {
          const response = await fetch(
            `${API_BASE_URL}${BLOG_ENDPOINT}/${blogId}`
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const blogData = await response.json();
          return blogData;
        } catch (error) {
          console.error("Error fetching blog data:", error);
          throw error;
        }
      }

      // Fetch category name (optional - if you have a categories endpoint)
      async function fetchCategoryName(categoryId) {
        try {
          const response = await fetch(
            `${API_BASE_URL}${CATEGORY_ENDPOINT}/${categoryId}`
          );
          if (response.ok) {
            const categoryData = await response.json();
            return categoryData.name || "Uncategorized";
          }
        } catch (error) {
          console.error("Error fetching category:", error);
        }
        return "Uncategorized";
      }

      // Populate blog content
      async function populateBlogContent(blogData) {
        // Update page title
        document.title = blogData.title;
        document.getElementById("page-title").textContent = blogData.title;

        // Update header content
        document.getElementById("blog-title").textContent = blogData.title;
        document.getElementById("blog-subtitle").textContent =
          blogData.excerpt || "Read this interesting blog post";
        document.getElementById("blog-author").textContent = blogData.author;
        document.getElementById("blog-date").textContent = formatDate(
          blogData.createdAt
        );
        document.getElementById("reading-time").textContent =
          estimateReadingTime(blogData.content);

        // Update category (you might want to fetch category name by ID)
        try {
          const categoryName = await fetchCategoryName(blogData.categoryId);
          document.getElementById("blog-category").textContent = categoryName;
        } catch (error) {
          document.getElementById("blog-category").textContent =
            "Uncategorized";
        }

        // Update excerpt
        if (blogData.excerpt) {
          document.getElementById("blog-excerpt-content").textContent =
            blogData.excerpt;
        } else {
          document.getElementById("blog-excerpt-content").style.display =
            "none";
        }

        // Update tags
        const tagsContainer = document.getElementById("blog-tags");
        if (blogData.tags && blogData.tags.length > 0) {
          tagsContainer.innerHTML = blogData.tags
            .map((tag) => `<span class="tag">${tag}</span>`)
            .join("");
        } else {
          tagsContainer.style.display = "none";
        }

        // Update main content
        document.getElementById("blog-main-content").innerHTML = formatContent(
          blogData.content
        );

        // Update author info
        document.getElementById("author-name").textContent = blogData.author;
        document.getElementById("author-avatar").textContent =
          getAuthorInitials(blogData.author);

        // Update dates
        document.getElementById("created-date").textContent = formatDate(
          blogData.createdAt
        );

        if (blogData.updatedAt && blogData.updatedAt !== blogData.createdAt) {
          document.getElementById("updated-date").textContent = formatDate(
            blogData.updatedAt
          );
          document.getElementById("updated-date-container").style.display =
            "block";
        }

        // Show the blog container
        document.getElementById("loading").style.display = "none";
        document.getElementById("blog-container").classList.add("loaded");
      }

      // Reading progress bar
      function updateProgressBar() {
        const article = document.querySelector(".blog-container");
        const progressBar = document.getElementById("progressBar");

        if (article) {
          const totalHeight = article.offsetHeight - window.innerHeight;
          const progress = (window.pageYOffset / totalHeight) * 100;
          progressBar.style.width = Math.min(progress, 100) + "%";
        }
      }

      // Initialize the page
      async function initializePage() {
        const blogId = getBlogIdFromUrl();

        if (!blogId) {
          showError("No blog ID provided in URL parameters");
          return;
        }

        try {
          const blogData = await fetchBlogData(blogId);
          await populateBlogContent(blogData.payload);

          // Set up progress bar
          window.addEventListener("scroll", updateProgressBar);
          updateProgressBar();
        } catch (error) {
          console.error("Error initializing page:", error);
          showError(
            "Failed to load blog post. Please check if the blog ID is correct and try again."
          );
        }
      }

      goBack = () => {
        window.history.back();
      };

      // Start the application when DOM is loaded
      document.addEventListener("DOMContentLoaded", initializePage);
    </script>
  </body>
</html>
