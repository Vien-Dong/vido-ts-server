<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n l√Ω Form - Admin</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <style>
      .card {
        transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      .btn-group-actions {
        gap: 5px;
      }
      .empty-state {
        padding: 60px 20px;
        text-align: center;
      }
      .empty-state i {
        font-size: 4rem;
        color: #6c757d;
        margin-bottom: 1rem;
      }
      .navbar-brand:hover {
        color: #fff !important;
      }
      .badge {
        font-size: 0.75rem;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="#" onclick="goToAdmin()"
          >Admin Dashboard</a
        >
        <div class="navbar-nav ms-auto">
          <a class="nav-link text-white" href="/medical/mng/ad/category" onclick="goToHome()"
            >Danh m·ª•c</a
          >
          <a class="nav-link text-white" href="/medical/mng/ad/blog" onclick="goToHome()"
            >B√†i vi·∫øt</a
          >
          <a class="nav-link text-white" href="#" onclick="goToHome()"
            >V·ªÅ trang ch·ªß</a
          >
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Qu·∫£n l√Ω Form ƒê√°nh gi√°</h1>
        <div class="d-flex align-items-center gap-3">
          <button class="btn btn-primary" onclick="createNewForm()">
            <i class="bi bi-plus-circle"></i>
            <span class="d-none d-sm-inline-flex">T·∫°o Form M·ªõi</span>
          </button>
          <button class="btn btn-success" onclick="createNewCategory()">
            <i class="bi bi-plus-circle"></i>
            <span class="d-none d-sm-inline-flex">T·∫°o Danh M·ª•c M·ªõi</span>
          </button>
        </div>
      </div>

      <div id="loadingIndicator" class="text-center my-5" style="display: none">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">ƒêang t·∫£i...</span>
        </div>
        <p class="mt-2 text-muted">ƒêang t·∫£i d·ªØ li·ªáu...</p>
      </div>

      <div id="formsContainer" class="row">
        <!-- Forms will be loaded here -->
      </div>

      <div id="emptyState" class="empty-state" style="display: none">
        <div>üìã</div>
        <h4 class="text-muted">Ch∆∞a c√≥ form n√†o</h4>
        <p class="text-muted">H√£y t·∫°o form ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
        <button class="btn btn-primary" onclick="createNewForm()">
          T·∫°o Form M·ªõi
        </button>
      </div>
    </div>

    <!-- Modal for creating new form -->
    <div
      class="modal fade"
      id="newFormModal"
      tabindex="-1"
      aria-labelledby="newFormModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newFormModalLabel">T·∫°o Form M·ªõi</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="newFormForm">
              <div class="mb-3">
                <label for="formTitle" class="form-label">Ti√™u ƒë·ªÅ Form *</label>
                <input
                  type="text"
                  class="form-control"
                  id="formTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="formDescription" class="form-label">M√¥ t·∫£</label>
                <textarea
                  class="form-control"
                  id="formDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="formCategory" class="form-label">Danh m·ª•c</label>
                <select class="form-select" id="formCategory">
                  <option value="medical">Y t·∫ø</option>
                  <option value="survey">Kh·∫£o s√°t</option>
                  <option value="feedback">Ph·∫£n h·ªìi</option>
                  <option value="evaluation">ƒê√°nh gi√°</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              H·ªßy
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveNewForm()"
            >
              T·∫°o Form
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for editing form -->
    <div
      class="modal fade"
      id="editFormModal"
      tabindex="-1"
      aria-labelledby="editFormModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editFormModalLabel">Ch·ªânh s·ª≠a Form</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editFormForm">
              <input type="hidden" id="editFormId" />
              <div class="mb-3">
                <label for="editFormTitle" class="form-label"
                  >Ti√™u ƒë·ªÅ Form *</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editFormTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editFormDescription" class="form-label"
                  >M√¥ t·∫£</label
                >
                <textarea
                  class="form-control"
                  id="editFormDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="editFormCategory" class="form-label"
                  >Danh m·ª•c</label
                >
                <select class="form-select" id="editFormCategory">
                  <option value="medical">Y t·∫ø</option>
                  <option value="survey">Kh·∫£o s√°t</option>
                  <option value="feedback">Ph·∫£n h·ªìi</option>
                  <option value="evaluation">ƒê√°nh gi√°</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              H·ªßy
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveEditForm()"
            >
              L∆∞u thay ƒë·ªïi
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for creating new category -->
    <div
      class="modal fade"
      id="newCategoryModal"
      tabindex="-1"
      aria-labelledby="newCategoryModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newCategoryModalLabel">
              T·∫°o Danh M·ª•c M·ªõi
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="newCategoryForm">
              <div class="mb-3">
                <label for="categoryTitle" class="form-label"
                  >Ti√™u ƒë·ªÅ danh m·ª•c *</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="categoryTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="categoryDescription" class="form-label"
                  >M√¥ t·∫£</label
                >
                <textarea
                  class="form-control"
                  id="categoryDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="categoryIcon" class="form-label"
                  >ƒê∆∞·ªùng d·∫´n icon *</label
                >
                <input type="text" class="form-control" id="categoryIcon" />
              </div>
              <div class="mb-3">
                <label for="categoryUrl" class="form-label"
                  >ƒê∆∞·ªùng d·∫´n ƒë·∫øn trang *</label
                >
                <input type="text" class="form-control" id="categoryUrl" />
              </div>
              <div class="mb-3">
                <label for="categoryType" class="form-label"
                  >Lo·∫°i danh m·ª•c *</label
                >
                <select class="form-select" id="categoryType" required>
                  <option value="">-- Ch·ªçn lo·∫°i --</option>
                  <option value="dropdown">Dropdown</option>
                  <option value="blog">Blog</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              H·ªßy
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveNewCategory()"
            >
              T·∫°o Danh M·ª•c
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for editing category -->
    <div
      class="modal fade"
      id="editCategoryModal"
      tabindex="-1"
      aria-labelledby="editCategoryModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="editCategoryModalLabel">
              Ch·ªânh s·ª≠a danh m·ª•c
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editCategoryForm">
              <input type="hidden" id="editCategoryId" />
              <div class="mb-3">
                <label for="editCategoryTitle" class="form-label"
                  >Ti√™u ƒë·ªÅ danh m·ª•c *</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="editCategoryTitle"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="editCategoryDescription" class="form-label"
                  >M√¥ t·∫£</label
                >
                <textarea
                  class="form-control"
                  id="editCategoryDescription"
                  rows="3"
                ></textarea>
              </div>
              <div class="mb-3">
                <label for="editCategoryIcon" class="form-label"
                  >ƒê∆∞·ªùng d·∫´n icon *</label
                >
                <input type="text" class="form-control" id="editCategoryIcon" />
              </div>
              <div class="mb-3">
                <label for="editCategoryUrl" class="form-label"
                  >ƒê∆∞·ªùng d·∫´n ƒë·∫øn trang *</label
                >
                <input type="text" class="form-control" id="editCategoryUrl" />
              </div>
              <div class="mb-3">
                <label for="editCategoryType" class="form-label"
                  >Lo·∫°i danh m·ª•c *</label
                >
                <select class="form-select" id="editCategoryType" required>
                  <option value="">-- Ch·ªçn lo·∫°i --</option>
                  <option value="dropdown">Dropdown</option>
                  <option value="blog">Blog</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              H·ªßy
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveEditCategory()"
            >
              L∆∞u thay ƒë·ªïi
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      // Sample data storage
      let forms = [];
      let categories = [];
      let isCreating = false;
      let isUpdating = false;
      let isDeleting = false;

      async function getForms() {
        try {
          const response = await axios.get("/api/medical");

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error fetching forms:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function createForms(data) {
        try {
          const response = await axios.post("/api/medical/admin/forms", data);

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error creating forms:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function updateForms(data, formId) {
        try {
          const response = await axios.put(
            `/api/medical/admin/forms/${formId}`,
            data
          );

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error updating forms:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function deleteForms(formId) {
        try {
          const response = await axios.delete(
            `/api/medical/admin/forms/${formId}`
          );

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error deleting forms:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function createCategories(data) {
        try {
          const response = await axios.post(
            "/api/medical/admin/categories",
            data
          );

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error creating categories:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function updateCategories(data, categoryId) {
        try {
          const response = await axios.put(
            `/api/medical/admin/categories/${categoryId}`,
            data
          );

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error updating categories:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      async function deleteCategories(categoryId) {
        try {
          const response = await axios.delete(
            `/api/medical/admin/categories/${categoryId}`
          );

          if (response && response.data && response.data.status)
            return response.data;

          return null;
        } catch (error) {
          console.error(
            "Error deleting categories:",
            error.response?.data || error.message
          );
          return null;
        }
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        loadForms();
      });

      async function loadForms() {
        const container = document.getElementById("formsContainer");
        const emptyState = document.getElementById("emptyState");
        const loading = document.getElementById("loadingIndicator");

        loading.style.display = "block";
        container.style.display = "none";
        emptyState.style.display = "none";

        const data = await getForms();

        loading.style.display = "none";

        if (data) {
          forms = data.payload;
          if (forms.length === 0) {
            container.style.display = "none";
            emptyState.style.display = "block";
            return;
          }

          container.style.display = "flex";
          emptyState.style.display = "none";

          container.innerHTML = forms
            .map(
              (form) => `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">${form.title}</h5>
                            <p class="card-text flex-grow-1">${
                              form.description || "Kh√¥ng c√≥ m√¥ t·∫£"
                            }</p>
                            <div class="mb-2">
                                <span class="badge bg-${getCategoryColor(
                                  form.category
                                )}">${getCategoryName(form.category)}</span>
                            </div>
                            <small class="text-muted mb-3">
                                T·∫°o: ${new Date(
                                  form.createdAt
                                ).toLocaleDateString("vi-VN")}
                            </small>
                            <div class="d-flex btn-group-actions">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewForm('${
                                  form._id
                                }')">
                                    Xem
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="editForm('${
                                  form._id
                                }')">
                                    S·ª≠a
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="deleteForm('${
                                  form._id
                                }')">
                                    X√≥a
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `
            )
            .join("");
        }
      }

      function getCategoryColor(category) {
        const colors = {
          medical: "success",
          survey: "info",
          feedback: "warning",
          evaluation: "primary",
        };
        return colors[category] || "secondary";
      }

      function getCategoryName(category) {
        const names = {
          medical: "Y t·∫ø",
          survey: "Kh·∫£o s√°t",
          feedback: "Ph·∫£n h·ªìi",
          evaluation: "ƒê√°nh gi√°",
        };
        return names[category] || "Kh√°c";
      }

      function createNewForm() {
        const modal = new bootstrap.Modal(
          document.getElementById("newFormModal")
        );
        modal.show();
      }

      function createNewCategory() {
        const modal = new bootstrap.Modal(
          document.getElementById("newCategoryModal")
        );
        modal.show();
      }

      async function saveNewForm() {
        if (isCreating) return; // tr√°nh double click
        isCreating = true;

        const btn = document.querySelector("#newFormModal .btn-primary");
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner-border spinner-border-sm me-1"></span> ƒêang t·∫°o...`;

        const title = document.getElementById("formTitle").value.trim();
        const description = document
          .getElementById("formDescription")
          .value.trim();
        const category = document.getElementById("formCategory").value;

        if (!title) {
          alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ form");
          resetCreateButton();
          return;
        }

        const newForm = {
          title: title,
          description: description || null,
          category: category,
          createdAt: new Date(),
        };

        const data = await createForms(newForm);

        if (data.status) {
          loadForms();

          // Clear form and close modal
          document.getElementById("newFormForm").reset();
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("newFormModal")
          );
          modal.hide();

          showToast("Form ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!", "success");
        } else {
          showToast("L·ªói t·∫°o form!", "info");
        }

        resetCreateButton();
      }

      function resetCreateButton() {
        isCreating = false;
        const btn = document.querySelector("#newFormModal .btn-primary");
        btn.disabled = false;
        btn.innerHTML = `T·∫°o Form`;
      }

      function editForm(formId) {
        const form = forms.find((f) => f._id === formId);
        if (!form) return;

        document.getElementById("editFormId").value = form._id;
        document.getElementById("editFormTitle").value = form.title;
        document.getElementById("editFormDescription").value =
          form.description || "";
        document.getElementById("editFormCategory").value = form.category;

        const modal = new bootstrap.Modal(
          document.getElementById("editFormModal")
        );
        modal.show();
      }

      async function saveEditForm() {
        if (isUpdating) return;
        isUpdating = true;

        const btn = document.querySelector("#editFormModal .btn-primary");
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner-border spinner-border-sm me-1"></span> ƒêang l∆∞u...`;

        const formId = document.getElementById("editFormId").value;
        const title = document.getElementById("editFormTitle").value.trim();
        const description = document
          .getElementById("editFormDescription")
          .value.trim();
        const category = document.getElementById("editFormCategory").value;

        if (!title) {
          alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ form");
          resetEditButton();
          return;
        }

        const formIndex = forms.findIndex((f) => f._id === formId);
        if (formIndex !== -1) {
          const body = {
            ...forms[formIndex],
            title: title,
            description: description || null,
            category: category,
          };

          const data = await updateForms(body, formId);

          if (data.status) {
            loadForms();

            const modal = bootstrap.Modal.getInstance(
              document.getElementById("editFormModal")
            );
            modal.hide();

            showToast("Form ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!", "success");
          } else {
            showToast("Form x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t!", "info");
          }
        }

        resetEditButton();
      }

      function resetEditButton() {
        isUpdating = false;
        const btn = document.querySelector("#editFormModal .btn-primary");
        btn.disabled = false;
        btn.innerHTML = `L∆∞u thay ƒë·ªïi`;
      }

      async function deleteForm(formId) {
        const form = forms.find((f) => f._id === formId);
        if (!form) return;

        if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a form "${form.title}"?`)) {
          const data = await deleteForms(formId);
          if (data.status) {
            loadForms();
            showToast("Form ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!", "success");
          } else {
            showToast("C√≥ l·ªói x·∫£y ra khi x√≥a form!", "info");
          }
        }
      }

      async function saveNewCategory() {
        if (isCreating) return; // tr√°nh double click
        isCreating = true;

        const btn = document.querySelector("#newCategoryModal .btn-primary");
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner-border spinner-border-sm me-1"></span> ƒêang t·∫°o...`;

        const title = document.getElementById("categoryTitle").value.trim();
        const description = document
          .getElementById("categoryDescription")
          .value.trim();
        const url = document.getElementById("categoryUrl").value;
        const iconUrl = document.getElementById("categoryIcon").value;
        const type = document.getElementById("categoryType").value;

        if (!title) {
          alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ danh m·ª•c");
          resetCreateButtonCategory();
          return;
        }

        const newCategory = {
          title: title,
          description: description || null,
          url: url,
          iconUrl: iconUrl,
          type: type,
          createdAt: new Date(),
        };

        const data = await createCategories(newCategory);

        if (data.status) {
          loadForms();

          // Clear category and close modal
          document.getElementById("newCategoryForm").reset();
          const modal = bootstrap.Modal.getInstance(
            document.getElementById("newCategoryModal")
          );
          modal.hide();

          showToast("Danh m·ª•c ƒë√£ ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng!", "success");
        } else {
          showToast("L·ªói t·∫°o danh m·ª•c!", "info");
        }

        resetCreateButtonCategory();
      }

      function resetCreateButtonCategory() {
        isCreating = false;
        const btn = document.querySelector("#newCategoryModal .btn-primary");
        btn.disabled = false;
        btn.innerHTML = `T·∫°o Danh M·ª•c`;
      }

      function editCategory(categoryId) {
        const category = categories.find((f) => f._id === categoryId);
        if (!category) return;

        document.getElementById("editCategoryId").value = category._id;
        document.getElementById("editCategoryTitle").value = category.title;
        document.getElementById("editCategoryDescription").value =
          category.description || "";
        document.getElementById("editCategoryUrl").value = category.url;
        document.getElementById("editCategoryIcon").value = category.iconUrl;
        document.getElementById("editCategoryType").value = category.type;

        const modal = new bootstrap.Modal(
          document.getElementById("editCategoryModal")
        );
        modal.show();
      }

      async function saveEditCategory() {
        if (isUpdating) return;
        isUpdating = true;

        const btn = document.querySelector("#editCategoryModal .btn-primary");
        btn.disabled = true;
        btn.innerHTML = `<span class="spinner-border spinner-border-sm me-1"></span> ƒêang l∆∞u...`;

        const categoryId = document.getElementById("editCategoryId").value;
        const title = document.getElementById("editCategoryTitle").value.trim();
        const description = document
          .getElementById("editCategoryDescription")
          .value.trim();
        const url = document.getElementById("editCategoryUrl").value;
        const iconUrl = document.getElementById("editCategoryIcon").value;
        const type = document.getElementById("editCategoryType").value;

        if (!title) {
          alert("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ danh m·ª•c");
          resetEditButtonCategory();
          return;
        }

        const categoryIndex = categories.findIndex((f) => f._id === categoryId);
        if (categoryIndex !== -1) {
          const body = {
            ...categorys[categoryIndex],
            title: title,
            description: description || null,
            url: url,
            iconUrl: iconUrl,
            type: type,
          };

          const data = await updateCategories(body, categoryId);

          if (data.status) {
            loadCategories();

            const modal = bootstrap.Modal.getInstance(
              document.getElementById("editCategoryModal")
            );
            modal.hide();

            showToast("Danh m·ª•c ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t th√†nh c√¥ng!", "success");
          } else {
            showToast("Danh m·ª•c x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t!", "info");
          }
        }

        resetEditButtonCategory();
      }

      function resetEditButtonCategory() {
        isUpdating = false;
        const btn = document.querySelector("#editCategoryModal .btn-primary");
        btn.disabled = false;
        btn.innerHTML = `L∆∞u thay ƒë·ªïi`;
      }

      async function deleteCategory(categoryId) {
        const category = categories.find((f) => f._id === categoryId);
        if (!category) return;

        if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c "${category.title}"?`)) {
          const data = await deleteCategories(categoryId);
          if (data.status) {
            loadCategories();
            showToast("Danh m·ª•c ƒë√£ ƒë∆∞·ª£c x√≥a th√†nh c√¥ng!", "success");
          } else {
            showToast("C√≥ l·ªói x·∫£y ra khi x√≥a danh m·ª•c!", "info");
          }
        }
      }

      function viewForm(formId) {
        window.location.href = `/medical/mng/ad/form?id=${formId}`;
      }

      function goToAdmin() {
        window.location.href = "/medical/mng/ad";
      }

      function goToHome() {
        window.location.href = "/medical";
      }

      function showToast(message, type = "info") {
        // Create toast element
        const toastHtml = `
                <div class="toast align-items-center text-white bg-${
                  type === "success" ? "success" : "info"
                } border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;

        // Create toast container if it doesn't exist
        let toastContainer = document.getElementById("toastContainer");
        if (!toastContainer) {
          toastContainer = document.createElement("div");
          toastContainer.id = "toastContainer";
          toastContainer.className =
            "toast-container position-fixed bottom-0 end-0 p-3";
          document.body.appendChild(toastContainer);
        }

        // Add toast to container
        toastContainer.insertAdjacentHTML("beforeend", toastHtml);

        // Initialize and show toast
        const toastElement = toastContainer.lastElementChild;
        const toast = new bootstrap.Toast(toastElement);
        toast.show();

        // Remove toast element after it's hidden
        toastElement.addEventListener("hidden.bs.toast", () => {
          toastElement.remove();
        });
      }
    </script>
  </body>
</html>
